
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>服务消费 · 面试知识点汇总</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-page-toc-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="服务发布和注册源码.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Java基础
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../JavaBasic/基本类型和包装类型.html">
            
                <a href="../JavaBasic/基本类型和包装类型.html">
            
                    
                    基本类型和包装类型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../JavaBasic/多态.html">
            
                <a href="../JavaBasic/多态.html">
            
                    
                    多态
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../JavaBasic/泛型.html">
            
                <a href="../JavaBasic/泛型.html">
            
                    
                    泛型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../JavaBasic/反射.html">
            
                <a href="../JavaBasic/反射.html">
            
                    
                    反射
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../JavaBasic/集合.html">
            
                <a href="../JavaBasic/集合.html">
            
                    
                    集合
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../JavaBasic/ConcurrentHashMap.html">
            
                <a href="../JavaBasic/ConcurrentHashMap.html">
            
                    
                    ConcurrentHashMap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../JavaBasic/HashMap.html">
            
                <a href="../JavaBasic/HashMap.html">
            
                    
                    HashMap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="../JavaBasic/hashcode和equals.html">
            
                <a href="../JavaBasic/hashcode和equals.html">
            
                    
                    hashcode和equals
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Java并发编程
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../JavaConcurrency/JMM.html">
            
                <a href="../JavaConcurrency/JMM.html">
            
                    
                    内存模型JMM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../JavaConcurrency/volatile.html">
            
                <a href="../JavaConcurrency/volatile.html">
            
                    
                    Volatile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../JavaConcurrency/synchronized.html">
            
                <a href="../JavaConcurrency/synchronized.html">
            
                    
                    Synchronized
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../JavaConcurrency/ReentrantLock.html">
            
                <a href="../JavaConcurrency/ReentrantLock.html">
            
                    
                    Lock
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../JavaConcurrency/Condition.html">
            
                <a href="../JavaConcurrency/Condition.html">
            
                    
                    并发工具
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../JavaConcurrency/threadpool.html">
            
                <a href="../JavaConcurrency/threadpool.html">
            
                    
                    线程池
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="../JavaConcurrency/ThreadLocal.html">
            
                <a href="../JavaConcurrency/ThreadLocal.html">
            
                    
                    ThreadLocal
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="../JavaConcurrency/阻塞队列和原子操作.html">
            
                <a href="../JavaConcurrency/阻塞队列和原子操作.html">
            
                    
                    原子操作和阻塞队列
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    虚拟机
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../JVM/内存区域.html">
            
                <a href="../JVM/内存区域.html">
            
                    
                    内存区域
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../JVM/内存分配和垃圾回收.html">
            
                <a href="../JVM/内存分配和垃圾回收.html">
            
                    
                    内存分配和垃圾回收
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../JVM/类加载.html">
            
                <a href="../JVM/类加载.html">
            
                    
                    类加载
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../JVM/JVM调优.html">
            
                <a href="../JVM/JVM调优.html">
            
                    
                    JVM调优
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    Mysql
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../Mysql/架构.html">
            
                <a href="../Mysql/架构.html">
            
                    
                    架构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../Mysql/索引.html">
            
                <a href="../Mysql/索引.html">
            
                    
                    索引
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../Mysql/执行计划.html">
            
                <a href="../Mysql/执行计划.html">
            
                    
                    执行计划
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../Mysql/锁和MVCC.html">
            
                <a href="../Mysql/锁和MVCC.html">
            
                    
                    锁和MVCC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../Mysql/优化.html">
            
                <a href="../Mysql/优化.html">
            
                    
                    Mysql优化
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    Redis
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../Redis/数据结构.html">
            
                <a href="../Redis/数据结构.html">
            
                    
                    数据结构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../Redis/基本功能.html">
            
                <a href="../Redis/基本功能.html">
            
                    
                    基本功能
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../Redis/集群.html">
            
                <a href="../Redis/集群.html">
            
                    
                    集群
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../Redis/应用.html">
            
                <a href="../Redis/应用.html">
            
                    
                    应用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    Dubbo
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="基本概念及使用.html">
            
                <a href="基本概念及使用.html">
            
                    
                    基本概念及使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="SPI.html">
            
                <a href="SPI.html">
            
                    
                    Dubbo SPI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="服务发布和注册源码.html">
            
                <a href="服务发布和注册源码.html">
            
                    
                    服务发布及注册
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.7.4" data-path="服务消费源码.html">
            
                <a href="服务消费源码.html">
            
                    
                    服务消费
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    Zookeeper
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../Zookeeper/节点.html">
            
                <a href="../Zookeeper/节点.html">
            
                    
                    节点
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../Zookeeper/集群.html">
            
                <a href="../Zookeeper/集群.html">
            
                    
                    集群
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../Zookeeper/启动与选举源码.html">
            
                <a href="../Zookeeper/启动与选举源码.html">
            
                    
                    启动及选举
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../Zookeeper/Watcher.html">
            
                <a href="../Zookeeper/Watcher.html">
            
                    
                    监听Watch
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="../Zookeeper/应用场景.html">
            
                <a href="../Zookeeper/应用场景.html">
            
                    
                    应用场景
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" >
            
                <span>
            
                    
                    Kafka
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../Kafka/基本使用.html">
            
                <a href="../Kafka/基本使用.html">
            
                    
                    基本使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../Kafka/集群.html">
            
                <a href="../Kafka/集群.html">
            
                    
                    集群
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../Kafka/MQ设计.html">
            
                <a href="../Kafka/MQ设计.html">
            
                    
                    MQ设计
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" >
            
                <span>
            
                    
                    Netty
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../Netty/Netty.html">
            
                <a href="../Netty/Netty.html">
            
                    
                    Netty
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" >
            
                <span>
            
                    
                    ES
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="../ES/基本概念.html">
            
                <a href="../ES/基本概念.html">
            
                    
                    基本概念
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="../ES/集群.html">
            
                <a href="../ES/集群.html">
            
                    
                    集群
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" >
            
                <span>
            
                    
                    Spring
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="../Spring/IOC.html">
            
                <a href="../Spring/IOC.html">
            
                    
                    IOC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="../Spring/DI.html">
            
                <a href="../Spring/DI.html">
            
                    
                    DI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="../Spring/AOP.html">
            
                <a href="../Spring/AOP.html">
            
                    
                    AOP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="../Spring/事务.html">
            
                <a href="../Spring/事务.html">
            
                    
                    事务
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="../Spring/MVC.html">
            
                <a href="../Spring/MVC.html">
            
                    
                    MVC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.6" data-path="../Spring/spring.html">
            
                <a href="../Spring/spring.html">
            
                    
                    MVC
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13" >
            
                <span>
            
                    
                    SpringCloud
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="../SpringCloud/Eureka.html">
            
                <a href="../SpringCloud/Eureka.html">
            
                    
                    Eureka
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.2" data-path="../SpringCloud/Ribbon.html">
            
                <a href="../SpringCloud/Ribbon.html">
            
                    
                    Ribbon
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.3" data-path="../SpringCloud/Feign.html">
            
                <a href="../SpringCloud/Feign.html">
            
                    
                    Feign
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.4" data-path="../SpringCloud/Hystrix.html">
            
                <a href="../SpringCloud/Hystrix.html">
            
                    
                    Hystrix
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" >
            
                <span>
            
                    
                    设计模式
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" data-path="../DesignPatterns/代理模式.html">
            
                <a href="../DesignPatterns/代理模式.html">
            
                    
                    代理模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.2" data-path="../DesignPatterns/单例模式.html">
            
                <a href="../DesignPatterns/单例模式.html">
            
                    
                    单例模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.3" data-path="../DesignPatterns/原型模式.html">
            
                <a href="../DesignPatterns/原型模式.html">
            
                    
                    原型模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.4" data-path="../DesignPatterns/委派和策略模式.html">
            
                <a href="../DesignPatterns/委派和策略模式.html">
            
                    
                    委派和策略模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.5" data-path="../DesignPatterns/装饰者和观察者模式.html">
            
                <a href="../DesignPatterns/装饰者和观察者模式.html">
            
                    
                    装饰者和观察者模式
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15" >
            
                <span>
            
                    
                    分布式
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.1" data-path="../Distribution/分布式事务.html">
            
                <a href="../Distribution/分布式事务.html">
            
                    
                    分布式事务
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.2" data-path="../Distribution/分布式ID.html">
            
                <a href="../Distribution/分布式ID.html">
            
                    
                    分布式ID
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16" >
            
                <span>
            
                    
                    系统设计
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.1" data-path="../SystemDesign/1小时内访问频率最高的10个ip.html">
            
                <a href="../SystemDesign/1小时内访问频率最高的10个ip.html">
            
                    
                    1小时内访问频率最高的10个ip
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2" data-path="../SystemDesign/抽奖系统.html">
            
                <a href="../SystemDesign/抽奖系统.html">
            
                    
                    抽奖系统
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.3" data-path="../SystemDesign/积分系统.html">
            
                <a href="../SystemDesign/积分系统.html">
            
                    
                    积分系统
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17" >
            
                <span>
            
                    
                    算法
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.1" >
            
                <span>
            
                    
                    二叉树
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.1.1" data-path="../Algorithm/二叉树的层序遍历.html">
            
                <a href="../Algorithm/二叉树的层序遍历.html">
            
                    
                    二叉树的层序遍历
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.1.2" data-path="../Algorithm/二叉树的层序遍历倒序.html">
            
                <a href="../Algorithm/二叉树的层序遍历倒序.html">
            
                    
                    二叉树的层序遍历倒序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.1.3" data-path="../Algorithm/二叉树的镜像.html">
            
                <a href="../Algorithm/二叉树的镜像.html">
            
                    
                    二叉树的镜像
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.1.4" data-path="../Algorithm/二叉树的最大路径和.html">
            
                <a href="../Algorithm/二叉树的最大路径和.html">
            
                    
                    二叉树的最大路径和
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.1.5" data-path="../Algorithm/二叉树的最大深度.html">
            
                <a href="../Algorithm/二叉树的最大深度.html">
            
                    
                    二叉树的最大深度
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.1.6" data-path="../Algorithm/二叉树的最近公共祖先.html">
            
                <a href="../Algorithm/二叉树的最近公共祖先.html">
            
                    
                    二叉树的最近公共祖先
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.1.7" data-path="../Algorithm/二叉树的最小深度.html">
            
                <a href="../Algorithm/二叉树的最小深度.html">
            
                    
                    二叉树的最小深度
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.1.8" data-path="../Algorithm/二叉树两个节点最短路径.html">
            
                <a href="../Algorithm/二叉树两个节点最短路径.html">
            
                    
                    二叉树两个节点最短路径
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.1.9" data-path="../Algorithm/二叉树存在给定值路径.html">
            
                <a href="../Algorithm/二叉树存在给定值路径.html">
            
                    
                    二叉树存在给定值路径
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.1.10" data-path="../Algorithm/对称二叉树.html">
            
                <a href="../Algorithm/对称二叉树.html">
            
                    
                    对称二叉树
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.1.11" data-path="../Algorithm/翻转二叉树.html">
            
                <a href="../Algorithm/翻转二叉树.html">
            
                    
                    翻转二叉树
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.1.12" data-path="../Algorithm/是否平衡二叉树.html">
            
                <a href="../Algorithm/是否平衡二叉树.html">
            
                    
                    是否平衡二叉树
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.1.13" data-path="../Algorithm/二叉树给定值所有路径.html">
            
                <a href="../Algorithm/二叉树给定值所有路径.html">
            
                    
                    二叉树给定值所有路径
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.1.14" data-path="../Algorithm/二叉树的所有路径.html">
            
                <a href="../Algorithm/二叉树的所有路径.html">
            
                    
                    二叉树的所有路径
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.1.15" data-path="../Algorithm/二叉树中和为某一值的路径.html">
            
                <a href="../Algorithm/二叉树中和为某一值的路径.html">
            
                    
                    二叉树中和为某一值的路径
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.1.16" data-path="../Algorithm/树的子结构.html">
            
                <a href="../Algorithm/树的子结构.html">
            
                    
                    树的子结构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.1.17" data-path="../Algorithm/判断二叉树对称.html">
            
                <a href="../Algorithm/判断二叉树对称.html">
            
                    
                    判断二叉树对称
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.1.18" data-path="../Algorithm/二叉树给定值路径.html">
            
                <a href="../Algorithm/二叉树给定值路径.html">
            
                    
                    二叉树给定值路径
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17.2" >
            
                <span>
            
                    
                    数组
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.2.1" data-path="../Algorithm/最大子序和.html">
            
                <a href="../Algorithm/最大子序和.html">
            
                    
                    最大子序和
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2.2" data-path="../Algorithm/和为S长度最小子数组.html">
            
                <a href="../Algorithm/和为S长度最小子数组.html">
            
                    
                    和为S长度最小子数组
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2.3" data-path="../Algorithm/数组中的第K个最大元素.html">
            
                <a href="../Algorithm/数组中的第K个最大元素.html">
            
                    
                    数组中的第K个最大元素
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2.4" data-path="../Algorithm/搜索插入位置.html">
            
                <a href="../Algorithm/搜索插入位置.html">
            
                    
                    搜索插入位置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2.5" data-path="../Algorithm/寻找数组的中心位置.html">
            
                <a href="../Algorithm/寻找数组的中心位置.html">
            
                    
                    寻找数组的中心位置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2.6" data-path="../Algorithm/颜色分类-分类排序.html">
            
                <a href="../Algorithm/颜色分类-分类排序.html">
            
                    
                    颜色分类-分类排序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2.7" data-path="../Algorithm/有序数组两数之和.html">
            
                <a href="../Algorithm/有序数组两数之和.html">
            
                    
                    有序数组两数之和
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2.8" data-path="../Algorithm/二分查找.html">
            
                <a href="../Algorithm/二分查找.html">
            
                    
                    二分查找
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2.9" data-path="../Algorithm/合并两个有序数组.html">
            
                <a href="../Algorithm/合并两个有序数组.html">
            
                    
                    合并两个有序数组
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2.10" data-path="../Algorithm/数组拆分返回最大子和.html">
            
                <a href="../Algorithm/数组拆分返回最大子和.html">
            
                    
                    数组拆分返回最大子和
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2.11" data-path="../Algorithm/移除指定元素.html">
            
                <a href="../Algorithm/移除指定元素.html">
            
                    
                    移除指定元素
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2.12" data-path="../Algorithm/最大连续1个数.html">
            
                <a href="../Algorithm/最大连续1个数.html">
            
                    
                    最大连续1个数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2.13" data-path="../Algorithm/移动0.html">
            
                <a href="../Algorithm/移动0.html">
            
                    
                    移动0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2.14" data-path="../Algorithm/合并区间.html">
            
                <a href="../Algorithm/合并区间.html">
            
                    
                    合并区间
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2.15" data-path="../Algorithm/插入区间.html">
            
                <a href="../Algorithm/插入区间.html">
            
                    
                    插入区间
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2.16" data-path="../Algorithm/汇总区间.html">
            
                <a href="../Algorithm/汇总区间.html">
            
                    
                    汇总区间
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2.17" data-path="../Algorithm/删除区间.html">
            
                <a href="../Algorithm/删除区间.html">
            
                    
                    删除区间
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2.18" data-path="../Algorithm/删除数组中的重复项-保留一个.html">
            
                <a href="../Algorithm/删除数组中的重复项-保留一个.html">
            
                    
                    删除数组中的重复项-保留一个
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2.19" data-path="../Algorithm/删除数组中的重复项-保留两个.html">
            
                <a href="../Algorithm/删除数组中的重复项-保留两个.html">
            
                    
                    删除数组中的重复项-保留两个
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2.20" data-path="../Algorithm/盛最多水的容器.html">
            
                <a href="../Algorithm/盛最多水的容器.html">
            
                    
                    盛最多水的容器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2.21" data-path="../Algorithm/两数组中最长重复子数组.html">
            
                <a href="../Algorithm/两数组中最长重复子数组.html">
            
                    
                    两数组中最长重复子数组
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2.22" data-path="../Algorithm/二维数组查找包含元素.html">
            
                <a href="../Algorithm/二维数组查找包含元素.html">
            
                    
                    二维数组查找包含元素
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2.23" data-path="../Algorithm/数组中重复数字.html">
            
                <a href="../Algorithm/数组中重复数字.html">
            
                    
                    数组中重复数字
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2.24" data-path="../Algorithm/调整数组顺序使奇数位于偶数前面.html">
            
                <a href="../Algorithm/调整数组顺序使奇数位于偶数前面.html">
            
                    
                    调整数组顺序使奇数位于偶数前面
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2.25" data-path="../Algorithm/最小K个数.html">
            
                <a href="../Algorithm/最小K个数.html">
            
                    
                    最小K个数
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17.3" >
            
                <span>
            
                    
                    字符串
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.3.1" data-path="../Algorithm/左旋转字符串.html">
            
                <a href="../Algorithm/左旋转字符串.html">
            
                    
                    左旋转字符串
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3.2" data-path="../Algorithm/最长公共前缀.html">
            
                <a href="../Algorithm/最长公共前缀.html">
            
                    
                    最长公共前缀
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3.3" data-path="../Algorithm/最长不含重复字符的子串.html">
            
                <a href="../Algorithm/最长不含重复字符的子串.html">
            
                    
                    最长不含重复字符的子串
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3.4" data-path="../Algorithm/最小覆盖字串.html">
            
                <a href="../Algorithm/最小覆盖字串.html">
            
                    
                    最小覆盖字串
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3.5" data-path="../Algorithm/验证回文串.html">
            
                <a href="../Algorithm/验证回文串.html">
            
                    
                    验证回文串
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3.6" data-path="../Algorithm/第一个只出现一次的字符.html">
            
                <a href="../Algorithm/第一个只出现一次的字符.html">
            
                    
                    第一个只出现一次的字符
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3.7" data-path="../Algorithm/反转字符串.html">
            
                <a href="../Algorithm/反转字符串.html">
            
                    
                    反转字符串
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17.4" >
            
                <span>
            
                    
                    链表
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.4.1" data-path="../Algorithm/翻转链表.html">
            
                <a href="../Algorithm/翻转链表.html">
            
                    
                    翻转链表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.4.2" data-path="../Algorithm/给定值分隔列表.html">
            
                <a href="../Algorithm/给定值分隔列表.html">
            
                    
                    给定值分隔列表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.4.3" data-path="../Algorithm/环形链表.html">
            
                <a href="../Algorithm/环形链表.html">
            
                    
                    环形链表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.4.4" data-path="../Algorithm/环形链表II.html">
            
                <a href="../Algorithm/环形链表II.html">
            
                    
                    环形链表II
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.4.5" data-path="../Algorithm/删除链表中重复元素.html">
            
                <a href="../Algorithm/删除链表中重复元素.html">
            
                    
                    删除链表中重复元素
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.4.6" data-path="../Algorithm/删除链表中重复元素不保留.html">
            
                <a href="../Algorithm/删除链表中重复元素不保留.html">
            
                    
                    删除链表中重复元素不保留
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.4.7" data-path="../Algorithm/合并两个有序列表.html">
            
                <a href="../Algorithm/合并两个有序列表.html">
            
                    
                    合并两个有序列表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.4.8" data-path="../Algorithm/删除链表给定值节点.html">
            
                <a href="../Algorithm/删除链表给定值节点.html">
            
                    
                    删除链表给定值节点
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.4.9" data-path="../Algorithm/链表中倒数第K个节点.html">
            
                <a href="../Algorithm/链表中倒数第K个节点.html">
            
                    
                    链表中倒数第K个节点
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17.5" >
            
                <span>
            
                    
                    动态规划
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.5.1" data-path="../Algorithm/整数拆分乘积最大.html">
            
                <a href="../Algorithm/整数拆分乘积最大.html">
            
                    
                    整数拆分乘积最大
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.5.2" data-path="../Algorithm/礼物的最大价值.html">
            
                <a href="../Algorithm/礼物的最大价值.html">
            
                    
                    礼物的最大价值
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17.6" >
            
                <span>
            
                    
                    其他
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.6.1" data-path="../Algorithm/两个栈实现队列.html">
            
                <a href="../Algorithm/两个栈实现队列.html">
            
                    
                    两个栈实现队列
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.6.2" data-path="../Algorithm/数值的整数次方.html">
            
                <a href="../Algorithm/数值的整数次方.html">
            
                    
                    数值的整数次方
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.18" >
            
                <span>
            
                    
                    Test
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.18.1" >
            
                <span>
            
                    
                    test1
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.18.1.1" >
            
                <span>
            
                    
                    test2
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.18.1.1.1" data-path="../MiddleWare/redis.md">
            
                <span>
            
                    
                    test3
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >服务消费</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="&#x670D;&#x52A1;&#x6D88;&#x8D39;&#x8FC7;&#x7A0B;">&#x670D;&#x52A1;&#x6D88;&#x8D39;&#x8FC7;&#x7A0B;</h1>
<p><img src="dubbo6.png" alt="dubbo6"></p>
<p>&#x670D;&#x52A1;&#x6D88;&#x8D39;&#x4E3B;&#x8981;&#x6709;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x529F;&#x80FD;&#xFF1A;&#x751F;&#x6210;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x7684;&#x4EE3;&#x7406;&#x3002;&#x83B7;&#x5F97;&#x76EE;&#x6807;&#x670D;&#x52A1;&#x7684;url&#x5730;&#x5740;&#x3002;&#x5B9E;&#x73B0;&#x8FDC;&#x7A0B;&#x7F51;&#x7EDC;&#x901A;&#x4FE1;&#x3002;&#x5B9E;&#x73B0;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x3002;&#x5B9E;&#x73B0;&#x96C6;&#x7FA4;&#x5BB9;&#x9519;&#x3002;</p>
<h1 id="&#x670D;&#x52A1;&#x6D88;&#x8D39;&#x8005;&#x521D;&#x59CB;&#x5316;">&#x670D;&#x52A1;&#x6D88;&#x8D39;&#x8005;&#x521D;&#x59CB;&#x5316;</h1>
<pre><code class="lang-java"><span class="hljs-comment">//&#x6D88;&#x8D39;&#x7AEF;&#x7684;&#x4EE3;&#x7801;&#x89E3;&#x6790;&#x662F;&#x4ECE;&#x4E0B;&#x9762;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x5F00;&#x59CB;&#x7684;</span>
&lt;dubbo:reference id=<span class="hljs-string">&quot;xxxService&quot;</span> <span class="hljs-class"><span class="hljs-keyword">interface</span></span>=<span class="hljs-string">&quot;xxx.xxx.Service&quot;</span>/&gt;
 <span class="hljs-comment">//&#x6CE8;&#x89E3;&#x7684;&#x65B9;&#x5F0F;&#x7684;&#x521D;&#x59CB;&#x5316;&#x5165;&#x53E3;</span>
   ReferenceAnnotationBeanPostProcessor-&gt;ReferenceBeanInvocationHandler.init- &gt;ReferenceConfig.get() 
  <span class="hljs-comment">//&#x83B7;&#x5F97;&#x4E00;&#x4E2A;&#x8FDC;&#x7A0B;&#x4EE3;&#x7406;&#x7C7B;</span>
</code></pre>
<h2 id="referenceconfigget">ReferenceConfig.get</h2>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> T <span class="hljs-title">get</span><span class="hljs-params">()</span> </span>{ 
  checkAndUpdateSubConfigs(); <span class="hljs-comment">//&#x68C0;&#x67E5;&#x548C;&#x4FEE;&#x6539;&#x914D;&#x7F6E;       </span>
  <span class="hljs-keyword">if</span> (destroyed) {            
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException;        
  }
  <span class="hljs-keyword">if</span> (ref == <span class="hljs-keyword">null</span>) { <span class="hljs-comment">//&#x5982;&#x679C;&#x5F53;&#x524D;&#x63A5;&#x53E3;&#x7684;&#x8FDC;&#x7A0B;&#x4EE3;&#x7406;&#x5F15;&#x7528;&#x4E3A;&#x7A7A;&#xFF0C;&#x5219;&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316; </span>
    init();
  }
  <span class="hljs-keyword">return</span> ref; 
}
</code></pre>
<h2 id="init">init()</h2>
<p>&#x521D;&#x59CB;&#x5316;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x548C;&#x670D;&#x52A1;&#x53D1;&#x5E03;&#x7684;&#x8FC7;&#x7A0B;&#x7C7B;&#x4F3C;&#xFF0C;&#x4F1A;&#x6709;&#x7279;&#x522B;&#x591A;&#x7684;&#x5224;&#x65AD;&#x4EE5;&#x53CA;&#x53C2;&#x6570;&#x7684;&#x7EC4;&#x88C5;&#x3002;&#x9700;&#x8981;&#x5173;&#x6CE8; createProxy&#xFF0C;&#x521B;&#x5EFA;&#x4EE3;&#x7406;&#x7C7B;&#x7684;&#x65B9;&#x6CD5;&#x3002;map&#x662F;&#x6240;&#x6709;&#x524D;&#x9762;&#x76F8;&#x5173;&#x53D8;&#x91CF;&#x7684;&#x53C2;&#x6570;&#x548C;&#x53C2;&#x6570;&#x503C;&#x3002;</p>
<pre><code class="lang-java"> <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> </span>{ 
   <span class="hljs-comment">//&#x7701;&#x7565;...</span>
    ref = createProxy(map);
   <span class="hljs-comment">//&#x7701;&#x7565;... </span>
 }
</code></pre>
<h2 id="createproxy">createProxy</h2>
<ol>
<li>&#x5224;&#x65AD;&#x662F;&#x5426;&#x4E3A;&#x672C;&#x5730;&#x8C03;&#x7528;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x5219;&#x4F7F;&#x7528;injvm&#x534F;&#x8BAE;&#x8FDB;&#x884C;&#x8C03;&#x7528;</li>
<li>&#x5224;&#x65AD;&#x662F;&#x5426;&#x4E3A;&#x70B9;&#x5BF9;&#x70B9;&#x8C03;&#x7528;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x5219;&#x628A;url&#x4FDD;&#x5B58;&#x5230;urls&#x96C6;&#x5408;&#x4E2D;&#xFF0C;&#x5982;&#x679C;url&#x4E3A;1&#xFF0C;&#x8FDB;&#x5165;&#x6B65;&#x9AA4;4&#xFF0C;&#x5982;&#x679C;urls&gt;1&#xFF0C;&#x5219;&#x6267;&#x884C;5</li>
<li>&#x5982;&#x679C;&#x662F;&#x914D;&#x7F6E;&#x4E86;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#xFF0C;&#x904D;&#x5386;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#xFF0C;&#x628A;url&#x6DFB;&#x52A0;&#x5230;urls&#x96C6;&#x5408;&#xFF0C;url&#x4E3A;1&#xFF0C;&#x8FDB;&#x5165;&#x6B65;&#x9AA4;4&#xFF0C;&#x5982;&#x679C;urls&gt;1&#xFF0C;&#x5219;&#x6267;&#x884C;5</li>
<li>&#x76F4;&#x63A5;&#x6784;&#x5EFA;invoker</li>
<li>&#x6784;&#x5EFA;invokers&#x96C6;&#x5408;&#xFF0C;&#x901A;&#x8FC7;cluster&#x5408;&#x5E76;&#x591A;&#x4E2A;invoker</li>
<li>&#x6700;&#x540E;&#x8C03;&#x7528; ProxyFactory &#x751F;&#x6210;&#x4EE3;&#x7406;&#x7C7B;</li>
</ol>
<pre><code class="lang-java"> <span class="hljs-function"><span class="hljs-keyword">private</span> T <span class="hljs-title">createProxy</span><span class="hljs-params">(Map&lt;String, String&gt; map)</span> </span>{
   <span class="hljs-comment">//&#x5982;&#x679C;&#x53EA;&#x914D;&#x7F6E;&#x4E86;&#x4E00;&#x4E2A;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#x6216;&#x8005;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x8005;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;refprotocol.refer </span>
   <span class="hljs-keyword">if</span> (urls.size() == <span class="hljs-number">1</span>) {                  
     invoker = refprotocol.refer(interfaceClass, urls.get(<span class="hljs-number">0</span>));            
   } <span class="hljs-keyword">else</span> {
     List&lt;Invoker&lt;?&gt;&gt; invokers = <span class="hljs-keyword">new</span> ArrayList&lt;Invoker&lt;?&gt;&gt;(); 
     URL registryURL = <span class="hljs-keyword">null</span>;
     <span class="hljs-keyword">for</span> (URL url : urls) {
       <span class="hljs-comment">//&#x904D;&#x5386;urls&#x751F;&#x6210;&#x591A;&#x4E2A;invoker</span>
       invokers.add(refprotocol.refer(interfaceClass, url));
       <span class="hljs-keyword">if</span> (Constants.REGISTRY_PROTOCOL.equals(url.getProtocol())) {
        registryURL = url; <span class="hljs-comment">// use last registry url</span>
       } 
     }
     <span class="hljs-keyword">if</span> (registryURL != <span class="hljs-keyword">null</span>) { <span class="hljs-comment">//&#x5982;&#x679C;registryUrl&#x4E0D;&#x4E3A;&#x7A7A;&#xFF0C;&#x6784;&#x5EFA;&#x9759;&#x6001;directory       </span>
       <span class="hljs-comment">// &#x4F7F;&#x7528;RegistryAwareCluster                    </span>
       URL u = registryURL.addParameter(Constants.CLUSTER_KEY,RegistryAwareCluster.NAME);
       <span class="hljs-comment">// &#x901A;&#x8FC7;Cluster&#x5C06;&#x591A;&#x4E2A;invoker&#x5408;&#x5E76; </span>
       <span class="hljs-comment">//RegistryAwareClusterInvoker(StaticDirectory) -&gt;FailoverClusterInvoker(RegistryDirectory, will execute route) -&gt; Invoker</span>
     } 
   }      
   invoker = cluster.join(<span class="hljs-keyword">new</span> StaticDirectory(u, invokers));
 } <span class="hljs-keyword">else</span> {
    invoker = cluster.join(<span class="hljs-keyword">new</span> StaticDirectory(invokers));
 }
<span class="hljs-comment">// create service proxy        </span>
<span class="hljs-keyword">return</span> (T) proxyFactory.getProxy(invoker);
}
</code></pre>
<h2 id="protocolrefer">protocol.refer</h2>
<p>&#x8FD9;&#x91CC;&#x901A;&#x8FC7;&#x6307;&#x5B9A;&#x7684;&#x534F;&#x8BAE;&#x6765;&#x8C03;&#x7528;refer&#x751F;&#x6210;&#x4E00;&#x4E2A;invoker&#x5BF9;&#x8C61;&#xFF0C;invoker&#x662F;&#x4E00;&#x4E2A;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x3002;&#x90A3;&#x4E48;&#x5728;&#x5F53;&#x524D;&#x7684;&#x6D88;&#x8D39;&#x7AEF;&#x800C;&#x8A00;&#xFF0C;invoker&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x6267;&#x884C;&#x8FDC;&#x7A0B;&#x8C03;&#x7528;&#x3002;</p>
<p>&#x8FD9;&#x4E2A;protocol&#xFF0C;&#x53C8;&#x662F;&#x4E00;&#x4E2A;&#x81EA;&#x9002;&#x5E94;&#x6269;&#x5C55;&#x70B9;&#xFF0C;&#x5B83;&#x5F97;&#x5230;&#x7684;&#x662F;Protocol$Adaptive&#x3002;&#x6839;&#x636E;&#x5F53;&#x524D;&#x7684;&#x534F;&#x8BAE;url&#xFF0C;&#x5F97;&#x5230;&#x4E00;&#x4E2A;&#x6307;&#x5B9A;&#x7684;&#x6269;&#x5C55;&#x70B9;&#xFF0C;&#x4F20;&#x9012;&#x8FDB;&#x6765;&#x7684;&#x53C2;&#x6570;&#x4E2D;&#xFF0C;&#x534F;&#x8BAE;&#x5730;&#x5740;&#x4E3A; registry://&#xFF0C;&#x6240;&#x4EE5;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5B9A;&#x4F4D;&#x5230;RegistryProtocol.refer&#x4EE3;&#x7801;&#x3002;</p>
<h2 id="registryprotocolrefer">RegistryProtocol.refer</h2>
<ol>
<li><p>&#x7EC4;&#x88C5;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#x534F;&#x8BAE;&#x7684;url &#x3002;</p>
</li>
<li><p>&#x5224;&#x65AD;&#x662F;&#x5426;&#x914D;&#x7F6E;&#x4E86;group&#xFF0C;&#x5982;&#x679C;&#x6709;&#xFF0C;&#x5219;cluster=getMergeableCluster()&#xFF0C;&#x6784;&#x5EFA;invoker &#x3002;</p>
</li>
<li><p>doRefer&#x6784;&#x5EFA;invoker</p>
</li>
</ol>
<pre><code class="lang-java"> <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">Invoker&lt;T&gt; <span class="hljs-title">refer</span><span class="hljs-params">(Class&lt;T&gt; type, URL url)</span> <span class="hljs-keyword">throws</span> RpcException </span>{ 
   <span class="hljs-comment">//&#x6839;&#x636E;&#x914D;&#x7F6E;&#x7684;&#x534F;&#x8BAE;&#xFF0C;&#x751F;&#x6210;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#x7684;url: zookeeper://    </span>
   url = URLBuilder.from(url)                
     .setProtocol(url.getParameter(REGISTRY_KEY, DEFAULT_REGISTRY))              
     .removeParameter(REGISTRY_KEY)              
     .build();        
   Registry registry = registryFactory.getRegistry(url);        
   <span class="hljs-keyword">if</span> (RegistryService.class.equals(type)) {            
     <span class="hljs-keyword">return</span> proxyFactory.getInvoker((T) registry, type, url);       
   }
   <span class="hljs-comment">// &#x89E3;&#x6790;group&#x53C2;&#x6570;&#xFF0C;&#x6839;&#x636E;group&#x51B3;&#x5B9A;cluster&#x7684;&#x7C7B;&#x578B;       </span>
   Map&lt;String, String&gt; qs = StringUtils.parseQueryString(url.getParameterAndDecoded(REFER_KEY));        
   String group = qs.get(Constants.GROUP_KEY);        
   <span class="hljs-keyword">if</span> (group != <span class="hljs-keyword">null</span> &amp;&amp; group.length() &gt; <span class="hljs-number">0</span>) {            
     <span class="hljs-keyword">if</span> ((COMMA_SPLIT_PATTERN.split(group)).length &gt; <span class="hljs-number">1</span> ||<span class="hljs-string">&quot;*&quot;</span>.equals(group)) {              
       <span class="hljs-keyword">return</span> doRefer(getMergeableCluster(), registry, type, url);           
     }
   }  
   <span class="hljs-comment">//&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x7EC4;&#x6216;&#x8005;&#x6CA1;&#x6709;&#x7EC4;&#x914D;&#x7F6E;&#xFF0C;&#x76F4;&#x63A5;&#x6267;&#x884C;</span>
   <span class="hljs-keyword">return</span> doRefer(cluster, registry, type, url); 
 }
</code></pre>
<h2 id="dorefer">doRefer</h2>
<p>&#x6784;&#x5EFA;&#x4E00;&#x4E2A;RegistryDirectory </p>
<p>&#x6784;&#x5EFA;&#x4E00;&#x4E2A;consumer://&#x534F;&#x8BAE;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x6CE8;&#x518C;&#x5230;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3; </p>
<p>&#x8BA2;&#x9605;zookeeper&#x4E2D;&#x8282;&#x70B9;&#x7684;&#x53D8;&#x5316;&#x3002;&#x76D1;&#x542C;providers&#xFF0C;configuraion&#x7B49;&#x8282;&#x70B9;&#x6570;&#x636E;</p>
<p>&#x8C03;&#x7528;cluster.join&#x65B9;&#x6CD5;&#x3002;Cluster&#x5C06;&#x591A;&#x4E2A;&#x670D;&#x52A1;&#x8282;&#x70B9;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x4E2A;&#xFF0C;&#x5E76;&#x751F;&#x6210;&#x4E00;&#x4E2A;invoker&#x3002;</p>
<pre><code class="lang-java"> <span class="hljs-keyword">private</span> &lt;T&gt; <span class="hljs-function">Invoker&lt;T&gt; <span class="hljs-title">doRefer</span><span class="hljs-params">(Cluster cluster, Registry registry, Class&lt;T&gt;type, URL url)</span> </span>{
   <span class="hljs-comment">//RegistryDirectory&#x521D;&#x59CB;&#x5316;</span>
   RegistryDirectory&lt;T&gt; directory = <span class="hljs-keyword">new</span> RegistryDirectory&lt;T&gt;(type, url); 
   <span class="hljs-comment">//&#x8BBE;&#x7F6E;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;</span>
   directory.setRegistry(registry);
   <span class="hljs-comment">//&#x8BBE;&#x7F6E;&#x534F;&#x8BAE;</span>
   directory.setProtocol(protocol);
   <span class="hljs-comment">// all attributes of REFER_KEY</span>
   Map&lt;String, String&gt; parameters = <span class="hljs-keyword">new</span> HashMap&lt;String, String&gt;(directory.getUrl().getParameters()); 
   <span class="hljs-comment">//&#x6CE8;&#x518C;consumer://&#x534F;&#x8BAE;&#x7684;url        </span>
   URL subscribeUrl = <span class="hljs-keyword">new</span> URL(CONSUMER_PROTOCOL,parameters.remove(REGISTER_IP_KEY), <span class="hljs-number">0</span>, type.getName(), parameters);        
   <span class="hljs-keyword">if</span> (!ANY_VALUE.equals(url.getServiceInterface()) &amp;&amp;url.getParameter(REGISTER_KEY, <span class="hljs-keyword">true</span>)) {    
     directory.setRegisteredConsumerUrl(getRegisteredConsumerUrl(subscribeUrl,url));  
     <span class="hljs-comment">//&#x6CE8;&#x518C;&#x670D;&#x52A1;&#x6D88;&#x8D39;&#x8005;</span>
     registry.register(directory.getRegisteredConsumerUrl());                
   }
   directory.buildRouterChain(subscribeUrl); 
   <span class="hljs-comment">//&#x8BA2;&#x9605;&#x4E8B;&#x4EF6;&#x76D1;&#x542C;(providers&#xFF0C;configuraion&#x7B49;&#x8282;&#x70B9;&#x6570;&#x636E;)        </span>
   directory.subscribe(subscribeUrl.addParameter(CATEGORY_KEY,PROVIDERS_CATEGORY + <span class="hljs-string">&quot;,&quot;</span> + CONFIGURATORS_CATEGORY + <span class="hljs-string">&quot;,&quot;</span> 
                                                 +ROUTERS_CATEGORY)); 
   <span class="hljs-comment">//&#x6784;&#x5EFA;invoker&#x3002;&#x4E00;&#x4E2A;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#x53EF;&#x80FD;&#x6709;&#x591A;&#x4E2A;&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x8005;&#xFF0C;&#x5C06;&#x591A;&#x4E2A;&#x670D;&#x52A1;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x4E2A;invoker        </span>
   Invoker invoker = cluster.join(directory);        
   ProviderConsumerRegTable.registerConsumer(invoker, url, subscribeUrl,directory);      
   <span class="hljs-keyword">return</span> invoker;    
 }
</code></pre>
<h2 id="clusterjoin">cluster.join</h2>
<p>cluster&#x5176;&#x5B9E;&#x662F;&#x5728;RegistryProtocol&#x4E2D;&#x901A;&#x8FC7;set&#x65B9;&#x6CD5;&#x5B8C;&#x6210;&#x4F9D;&#x8D56;&#x6CE8;&#x5165;&#x7684;&#xFF0C;&#x5B83;&#x662F;&#x4E00;&#x4E2A;Cluster&#x6269;&#x5C55;&#x70B9;&#x7684;&#x5B9A;&#x4E49;&#x5E76;&#x4E14;&#x505A;&#x4E86;&#x5305;&#x88C5;&#xFF0C;&#x5B9E;&#x9645;&#x662F;&#x8C03;&#x7528;MockClusterWrapper(FailOverCluster.join)&#x3002;&#x8FD4;&#x56DE;&#x7684;invoker&#x5E94;&#x8BE5;&#x662F;MockClusterWrapper(FailOverCluster(directory))&#x3002;</p>
<h2 id="proxyfactorygetproxy">proxyFactory.getProxy</h2>
<p>&#x62FF;&#x5230;invoker&#x4E4B;&#x540E;&#xFF0C;&#x4F1A;&#x8C03;&#x7528;&#x83B7;&#x5F97;&#x4E00;&#x4E2A;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x7C7B;</p>
<pre><code class="lang-java"><span class="hljs-keyword">return</span> (T) proxyFactory.getProxy(invoker);

<span class="hljs-comment">//proxyFactory&#x53C8;&#x662F;&#x4E00;&#x4E2A;&#x81EA;&#x9002;&#x5E94;&#x6269;&#x5C55;&#x70B9;</span>
 <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">getProxy</span><span class="hljs-params">(Invoker&lt;T&gt; invoker, Class&lt;?&gt;[]interfaces)</span> </span>{       
   <span class="hljs-keyword">return</span> (T) Proxy.getProxy(interfaces).newInstance(<span class="hljs-keyword">new</span> InvokerInvocationHandler(invoker));    
 }
</code></pre>
<p>&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x751F;&#x6210;&#x4E86;&#x4E00;&#x4E2A;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x7C7B;&#xFF0C;&#x5E76;&#x4E14;&#x5BF9;invoker&#x518D;&#x505A;&#x4E86;&#x4E00;&#x5C42;&#x5904;&#x7406;&#xFF0C;InvokerInvocationHandler&#x3002; &#x610F;&#x5473;&#x7740;&#x540E;&#x7EED;&#x53D1;&#x8D77;&#x670D;&#x52A1;&#x8C03;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x7531;InvokerInvocationHandler&#x6765;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;</p>
<p>@Reference&#x6CE8;&#x5165;&#x7684;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x5B9E;&#x4F8B;&#x672C;&#x8D28;&#x4E0A;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x7C7B;&#xFF0C;&#x901A;&#x8FC7;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x7C7B;&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x4F1A;&#x89E6;&#x53D1; handler.invoke(), &#x800C;&#x8FD9;&#x4E2A;handler&#x5C31;&#x662F;InvokerInvocationHandler&#x3002;</p>
<h2 id="&#x670D;&#x52A1;&#x8BA2;&#x9605;">&#x670D;&#x52A1;&#x8BA2;&#x9605;</h2>
<h3 id="directorysubscribe">directory.subscribe</h3>
<p>doRefer&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;directory.subscribe&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x5B83;&#x662F;&#x5B9E;&#x73B0;&#x670D;&#x52A1;&#x7684;&#x76EE;&#x6807;&#x670D;&#x52A1;&#x8BA2;&#x9605;&#x3002;</p>
<p>&#x8BA2;&#x9605;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#x6307;&#x5B9A;&#x8282;&#x70B9;&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x5982;&#x679C;&#x53D1;&#x751F;&#x53D8;&#x5316;&#xFF0C;&#x5219;&#x901A;&#x77E5;&#x5230;RegistryDirectory&#x3002;Directory&#x548C;&#x670D;&#x52A1;&#x7684;&#x6CE8;&#x518C;&#x4EE5;&#x53CA;&#x670D;&#x52A1;&#x7684;&#x53D1;&#x73B0;&#x6709;&#x975E;&#x5E38;&#x5927;&#x7684;&#x5173;&#x8054;&#x3002;</p>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">subscribe</span><span class="hljs-params">(URL url)</span> </span>{
  setConsumerUrl(url); <span class="hljs-comment">//&#x8BBE;&#x7F6E;consumerUrl </span>
  <span class="hljs-comment">//&#x628A;&#x5F53;&#x524D;RegistryDirectory&#x4F5C;&#x4E3A;listener&#xFF0C;&#x53BB;&#x76D1;&#x542C;zk&#x4E0A;&#x8282;&#x70B9;&#x7684;&#x53D8;&#x5316; </span>
  consumerConfigurationListener.addNotifyListener(<span class="hljs-keyword">this</span>); 
  serviceConfigurationListener = <span class="hljs-keyword">new</span> ReferenceConfigurationListener(<span class="hljs-keyword">this</span>,url); 
  registry.subscribe(url, <span class="hljs-keyword">this</span>);<span class="hljs-comment">//&#x8BA2;&#x9605; -&gt; &#x8FD9;&#x91CC;&#x7684;registryzookeeperRegsitry</span>
  <span class="hljs-comment">//&#x76D1;&#x542C;providers&#xFF0C;configuraion,rouers&#x8282;&#x70B9;&#x4E0B;&#x9762;&#x5B50;&#x8282;&#x70B9;&#x53D8;&#x5316;</span>
}
</code></pre>
<h3 id="failbackregistrysubscribe">FailbackRegistry.subscribe</h3>
<p>&#x79FB;&#x9664;&#x5931;&#x6548;&#x7684;listener&#xFF0C;&#x8C03;&#x7528;doSubscribe&#x8FDB;&#x884C;&#x8BA2;&#x9605;&#x3002;listener&#x4E3A;RegistryDirectory&#xFF0C;&#x540E;&#x7EED;&#x8981;&#x7528;&#x5230;&#x3002;</p>
<h3 id="zookeeperregistrydosubscribe">ZookeeperRegistry.doSubscribe</h3>
<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x662F;&#x8BA2;&#x9605;&#xFF0C;&#x903B;&#x8F91;&#x5B9E;&#x73B0;&#x6BD4;&#x8F83;&#x591A;&#xFF0C;&#x53EF;&#x4EE5;&#x5206;&#x4E24;&#x6BB5;&#x6765;&#x770B;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;&#x5B9E;&#x73B0;&#x628A;&#x6240;&#x6709;Service&#x5C42;&#x53D1;&#x8D77;&#x7684;&#x8BA2;&#x9605;&#x4EE5;&#x53CA;&#x6307;&#x5B9A; &#x7684;Service&#x5C42;&#x53D1;&#x8D77;&#x7684;&#x8BA2;&#x9605;&#x5206;&#x5F00;&#x5904;&#x7406;&#x3002;&#x6240;&#x6709;Service&#x5C42;&#x7C7B;&#x4F3C;&#x4E8E;&#x76D1;&#x63A7;&#x4E2D;&#x5FC3;&#x53D1;&#x8D77;&#x7684;&#x8BA2;&#x9605;&#x3002;&#x6307;&#x5B9A;&#x7684;Service&#x5C42;&#x53D1;&#x8D77;&#x7684; &#x8BA2;&#x9605;&#x53EF;&#x4EE5;&#x770B;&#x4F5C;&#x662F;&#x670D;&#x52A1;&#x6D88;&#x8D39;&#x8005;&#x7684;&#x8BA2;&#x9605;&#x3002;&#x6211;&#x53EA;&#x9700;&#x8981;&#x5173;&#x5FC3;&#x6307;&#x5B9A;service&#x5C42;&#x53D1;&#x8D77;&#x7684;&#x8BA2;&#x9605;&#x5373;&#x53EF;&#x3002;</p>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doSubscribe</span><span class="hljs-params">(<span class="hljs-keyword">final</span> URL url, <span class="hljs-keyword">final</span> NotifyListener listener)</span> </span>{        
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">if</span> (Constants.ANY_VALUE.equals(url.getServiceInterface())) { 
      <span class="hljs-comment">//&#x7701;&#x7565;&#x90E8;&#x5206;&#x4EE3;&#x7801;           </span>
    } <span class="hljs-keyword">else</span> {               
      List&lt;URL&gt; urls = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();                
      <span class="hljs-keyword">for</span> (String path : toCategoriesPath(url)) {                   
        ConcurrentMap&lt;NotifyListener, ChildListener&gt; listeners =zkListeners.get(url);
        <span class="hljs-comment">// &#x5982;&#x679C;&#x4E4B;&#x524D;&#x8BE5;&#x8DEF;&#x5F84;&#x6CA1;&#x6709;&#x6DFB;&#x52A0;&#x8FC7;listener&#xFF0C;&#x5219;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;map&#x6765;&#x653E;&#x7F6E;listener </span>
        <span class="hljs-keyword">if</span> (listeners == <span class="hljs-keyword">null</span>) {                        
          zkListeners.putIfAbsent(url, <span class="hljs-keyword">new</span> ConcurrentHashMap&lt;&gt;());                        
          listeners = zkListeners.get(url);                  
        }                             
        ChildListener zkListener = listeners.get(listener);
        <span class="hljs-keyword">if</span> (zkListener == <span class="hljs-keyword">null</span>) {
          <span class="hljs-comment">// &#x5982;&#x679C;&#x6CA1;&#x6709;&#x6DFB;&#x52A0;&#x8FC7;&#x5BF9;&#x4E8E;&#x5B50;&#x8282;&#x70B9;&#x7684;listener&#xFF0C;&#x5219;&#x521B;&#x5EFA;,&#x901A;&#x77E5;&#x670D;&#x52A1;&#x53D8;&#x5316; &#x56DE;&#x8C03;NotifyListener                        </span>
          listeners.putIfAbsent(listener, (parentPath,currentChilds) -&gt; ZookeeperRegistry.<span class="hljs-keyword">this</span>.notify(url, listener,
                                                              toUrlsWithEmpty(url,parentPath, currentChilds)));                        
          zkListener = listeners.get(listener);    
        } 
        <span class="hljs-comment">//&#x6DFB;&#x52A0;path&#x8282;&#x70B9;&#x7684;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x53CA;&#x5B50;&#x8282;&#x70B9;&#x76D1;&#x542C;&#xFF0C;&#x5E76;&#x4E14;&#x83B7;&#x53D6;&#x5B50;&#x8282;&#x70B9;&#x4FE1;&#x606F; //&#x4E5F;&#x5C31;&#x662F;dubbo://ip:port/...</span>
        zkClient.create(path, <span class="hljs-keyword">false</span>);
        List&lt;String&gt; children = zkClient.addChildListener(path,zkListener);
        <span class="hljs-keyword">if</span> (children != <span class="hljs-keyword">null</span>) {           
          urls.addAll(toUrlsWithEmpty(url, path, children));
        } 
      }
      <span class="hljs-comment">//&#x8C03;&#x7528;notify&#x8FDB;&#x884C;&#x901A;&#x77E5;&#xFF0C;&#x5BF9;&#x5DF2;&#x7ECF;&#x53EF;&#x7528;&#x7684;&#x5217;&#x8868;&#x8FDB;&#x884C;&#x901A;&#x77E5; </span>
      notify(url, listener, urls);
    }        
  } <span class="hljs-keyword">catch</span> (Throwable e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RpcException();        
  }
}
</code></pre>
<h3 id="failbackregistrynotify">FailbackRegistry.notify</h3>
<p>&#x8C03;&#x7528;FailbackRegistry.notify&#xFF0C; &#x5BF9;&#x53C2;&#x6570;&#x8FDB;&#x884C;&#x5224;&#x65AD;&#x3002; &#x7136;&#x540E;&#x8C03;&#x7528;AbstractRegistry.notify&#x65B9;&#x6CD5;&#x3002;</p>
<p>AbstractRegistry.notify&#x4F1A;&#x9488;&#x5BF9;&#x6BCF;&#x4E00;&#x4E2A;category&#xFF0C;&#x8C03;&#x7528;listener.notify&#x8FDB;&#x884C;&#x901A;&#x77E5;&#xFF0C;&#x7136;&#x540E;&#x66F4;&#x65B0;&#x672C;&#x5730;&#x7684;&#x7F13;&#x5B58;&#x6587;&#x4EF6;&#x3002;</p>
<p>&#x6D88;&#x8D39;&#x7AEF;&#x7684;listener&#x662F;&#x6700;&#x5F00;&#x59CB;&#x4F20;&#x9012;&#x8FC7;&#x6765;&#x7684;RegistryDirectory&#xFF0C;&#x8FD9;&#x91CC;&#x4F1A;&#x89E6;&#x53D1;RegistryDirectory.notify&#x3002;</p>
<h3 id="registrydirectorynotify">RegistryDirectory.notify</h3>
<p>Invoker&#x7684;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;&#x4EE5;&#x53CA;&#x540E;&#x7EED;&#x7684;&#x914D;&#x7F6E;&#x53D8;&#x66F4;&#xFF0C;&#x90FD;&#x4F1A;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;notify&#x65B9;&#x6CD5;&#x3002;urls&#x8868;&#x793A;zk&#x7684;path&#x6570;&#x636E;&#xFF0C;&#x8FD9;&#x91CC;&#x8868;&#x793A;&#x7684;&#x662F;dubbo://&#x3002;</p>
<pre><code class="lang-java"> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notify</span><span class="hljs-params">(List&lt;URL&gt; urls)</span> </span>{ 
   <span class="hljs-comment">//&#x5BF9;url&#x5217;&#x8868;&#x8FDB;&#x884C;&#x6821;&#x9A8C;&#x3001;&#x8FC7;&#x6EE4;&#xFF0C;&#x7136;&#x540E;&#x5206;&#x6210; config&#x3001;router&#x3001;provider 3&#x4E2A;&#x5206;&#x7EC4;map       </span>
   Map&lt;String, List&lt;URL&gt;&gt; categoryUrls = urls.stream()                
     .filter(Objects::nonNull)              
     .filter(<span class="hljs-keyword">this</span>::isValidCategory)                
     .filter(<span class="hljs-keyword">this</span>::isNotCompatibleFor26x)              
     .collect(Collectors.groupingBy(url -&gt; {                   
       <span class="hljs-keyword">if</span> (UrlUtils.isConfigurator(url)) {                       
         <span class="hljs-keyword">return</span> CONFIGURATORS_CATEGORY;                    
       } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (UrlUtils.isRoute(url)) {                    
         <span class="hljs-keyword">return</span> ROUTERS_CATEGORY;                 
       } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (UrlUtils.isProvider(url)) {                        
         <span class="hljs-keyword">return</span> PROVIDERS_CATEGORY;
       }                    
       <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>                
     }));        
   List&lt;URL&gt; configuratorURLs = categoryUrls.getOrDefault(CONFIGURATORS_CATEGORY, Collections.emptyList());   
   <span class="hljs-keyword">this</span>.configurators = Configurator.toConfigurators(configuratorURLs).orElse(<span class="hljs-keyword">this</span>.configurators); 
   <span class="hljs-comment">// &#x5982;&#x679C;router &#x8DEF;&#x7531;&#x8282;&#x70B9;&#x6709;&#x53D8;&#x5316;&#xFF0C;&#x5219;&#x4ECE;&#x65B0;&#x5C06;router &#x4E0B;&#x7684;&#x6570;&#x636E;&#x751F;&#x6210;router        </span>
   List&lt;URL&gt; routerURLs = categoryUrls.getOrDefault(ROUTERS_CATEGORY,Collections.emptyList());        
   toRouters(routerURLs).ifPresent(<span class="hljs-keyword">this</span>::addRouters);
   <span class="hljs-comment">// &#x83B7;&#x5F97;provider URL&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x7528;refreshOverrideAndInvoker&#x8FDB;&#x884C;&#x5237;&#x65B0;    </span>
   List&lt;URL&gt; providerURLs = categoryUrls.getOrDefault(PROVIDERS_CATEGORY,Collections.emptyList());        
   refreshOverrideAndInvoker(providerURLs);    
 }
</code></pre>
<h2 id="&#x6784;&#x5EFA;invoker">&#x6784;&#x5EFA;Invoker</h2>
<h3 id="refreshoverrideandinvoker">refreshOverrideAndInvoker</h3>
<p>&#x9010;&#x4E2A;&#x8C03;&#x7528;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#x91CC;&#x9762;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x8986;&#x76D6;&#x539F;&#x6765;&#x7684;url&#xFF0C;&#x7EC4;&#x6210;&#x6700;&#x65B0;&#x7684;url &#x653E;&#x5165;overrideDirectoryUrl &#x5B58;&#x50A8;&#x3002;&#x6839;&#x636E; provider urls&#xFF0C;&#x91CD;&#x65B0;&#x5237;&#x65B0;Invoker</p>
<pre><code class="lang-java"> <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">refreshOverrideAndInvoker</span><span class="hljs-params">(List&lt;URL&gt; urls)</span> </span>{
    <span class="hljs-comment">// mock zookeeper://xxx?mock=return null</span>
    overrideDirectoryUrl();
    refreshInvoker(urls);
}
</code></pre>
<h3 id="refreshinvoker">refreshInvoker</h3>
<pre><code class="lang-java"> <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">refreshInvoker</span><span class="hljs-params">(List&lt;URL&gt; invokerUrls)</span> </span>{      
   Assert.notNull(invokerUrls, <span class="hljs-string">&quot;invokerUrls should not be null&quot;</span>);       
   <span class="hljs-keyword">if</span> (invokerUrls.size() == <span class="hljs-number">1</span>&amp;&amp; invokerUrls.get(<span class="hljs-number">0</span>) != <span class="hljs-keyword">null</span>&amp;&amp; Constants.EMPTY_PROTOCOL.equals(invokerUrls.get(<span class="hljs-number">0</span>).getProtocol())) { 
     <span class="hljs-comment">//&#x7701;&#x7565;&#x90E8;&#x5206;&#x4EE3;&#x7801;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x7A7A;&#x534F;&#x8BAE;&#xFF0C;&#x5219;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x4E0D;&#x5141;&#x8BB8;&#x8BBF;&#x95EE;       </span>
   } <span class="hljs-keyword">else</span> {            
     <span class="hljs-keyword">this</span>.forbidden = <span class="hljs-keyword">false</span>; <span class="hljs-comment">// Allow to access            </span>
     Map&lt;String, Invoker&lt;T&gt;&gt; oldUrlInvokerMap = <span class="hljs-keyword">this</span>.urlInvokerMap; <span class="hljs-comment">//local reference</span>
       <span class="hljs-keyword">if</span> (invokerUrls.isEmpty()) {<span class="hljs-comment">//&#x5982;&#x679C;url&#x4E3A;&#x7A7A;&#xFF0C;&#x5219;&#x76F4;&#x63A5;&#x8FD4;&#x56DE; </span>
         <span class="hljs-keyword">return</span>;
       }
     <span class="hljs-comment">//&#x6839;&#x636E;provider url&#xFF0C;&#x751F;&#x6210;&#x65B0;&#x7684;invoker          </span>
     Map&lt;String, Invoker&lt;T&gt;&gt; newUrlInvokerMap =toInvokers(invokerUrls);     
     <span class="hljs-comment">//&#x8F6C;&#x5316;&#x4E3A;list</span>
     List&lt;Invoker&lt;T&gt;&gt; newInvokers = Collections.unmodifiableList(newArrayList&lt;&gt;(newUrlInvokerMap.values()));       
     routerChain.setInvokers(newInvokers);
     <span class="hljs-comment">//&#x5982;&#x679C;&#x670D;&#x52A1;&#x914D;&#x7F6E;&#x4E86;&#x5206;&#x7EC4;&#xFF0C;&#x5219;&#x628A;&#x5206;&#x7EC4;&#x4E0B;&#x7684;provider&#x5305;&#x88C5;&#x6210;StaticDirectory,&#x7EC4;&#x6210;&#x4E00;&#x4E2A; invoker//&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x6309;&#x7167;group&#x8FDB;&#x884C;&#x5408;&#x5E76;</span>
     <span class="hljs-keyword">this</span>.invokers = multiGroup ? toMergeInvokerList(newInvokers) : newInvokers;
     <span class="hljs-keyword">this</span>.urlInvokerMap = newUrlInvokerMap;
     <span class="hljs-keyword">try</span> {
       <span class="hljs-comment">//&#x65E7;&#x7684;url &#x662F;&#x5426;&#x5728;&#x65B0;map&#x91CC;&#x9762;&#x5B58;&#x5728;&#xFF0C;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x5C31;&#x662F;&#x9500;&#x6BC1;url&#x5BF9;&#x5E94;&#x7684;Invoker </span>
       destroyUnusedInvokers(oldUrlInvokerMap, newUrlInvokerMap);
        } <span class="hljs-keyword">catch</span> (Exception e) {
                logger.warn(<span class="hljs-string">&quot;destroyUnusedInvokers error. &quot;</span>, e);
     } 
   }
}
</code></pre>
<h3 id="toinvokers">toInvokers</h3>
<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x521D;&#x59CB;&#x5316;&#x4E86;invoker&#x3002;&#x7528;&#x5230;&#x4E86;protocol.refer&#x6765;&#x6784;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;invoker&#x3002;</p>
<pre><code class="lang-java">invoker = <span class="hljs-keyword">new</span> InvokerDelegate&lt;&gt;(protocol.refer(serviceType, url),url,providerUrl);
</code></pre>
<p>&#x6784;&#x5EFA;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#xFF0C;&#x4F1A;&#x4FDD;&#x5B58;&#x5728;Map<string, invoker\<t="">&gt; newUrlInvokerMap&#x8FD9;&#x4E2A;&#x96C6;&#x5408;&#x4E2D;&#x3002;</string,></p>
<h3 id="protocolrefer">protocol.refer</h3>
<p>&#x8C03;&#x7528;&#x6307;&#x5B9A;&#x7684;&#x534F;&#x8BAE;&#x6765;&#x8FDB;&#x884C;&#x8FDC;&#x7A0B;&#x5F15;&#x7528;&#x3002;protocol&#x662F;&#x4E00;&#x4E2A;Protocol$Adaptive&#x7C7B; &#x800C;&#x771F;&#x6B63;&#x7684;&#x5B9E;&#x73B0;&#x5E94;&#x8BE5;&#x662F;:</p>
<p>ProtocolListenerWrapper(ProtocolFilterWrapper(QosProtocolWrapper(DubboProtocol.refer) &#x3002;&#x524D;&#x9762;&#x7684;&#x5305;&#x88C5;&#x8FC7;&#x7A0B;&#xFF0C;&#x5728;&#x670D;&#x52A1;&#x53D1;&#x5E03;&#x7684;&#x65F6;&#x5019;&#x5DF2;&#x7ECF;&#x5206;&#x6790;&#x8FC7;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x8FDB;&#x5165;DubboProtocol.refer&#x65B9;&#x6CD5;&#x3002;</p>
<h3 id="dubboprotocolrefer">DubboProtocol.refer</h3>
<p>&#x4F18;&#x5316;&#x5E8F;&#x5217;&#x5316;&#xFF0C;&#x6784;&#x5EFA;DubboInvoker&#x3002;&#x5728;&#x6784;&#x5EFA;DubboInvoker&#x65F6;&#xFF0C;&#x4F1A;&#x6784;&#x5EFA;&#x4E00;&#x4E2A;ExchangeClient&#xFF0C;&#x901A;&#x8FC7;getClients(url)&#x65B9;&#x6CD5;&#xFF0C;&#x5EFA;&#x7ACB;&#x670D;&#x52A1;&#x901A;&#x4FE1;&#x3002;</p>
<pre><code class="lang-java"><span class="hljs-meta">@Override</span>   
<span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">Invoker&lt;T&gt; <span class="hljs-title">refer</span><span class="hljs-params">(Class&lt;T&gt; serviceType, URL url)</span> throwsRpcException </span>{        
  optimizeSerialization(url);        
  <span class="hljs-comment">// create rpc invoker. &#x6784;&#x5EFA;DubboInvoker      </span>
  DubboInvoker&lt;T&gt; invoker = <span class="hljs-keyword">new</span> DubboInvoker&lt;T&gt;(serviceType, url,getClients(url), invokers);       
  invokers.add(invoker);       
  <span class="hljs-keyword">return</span> invoker;
}
</code></pre>
<h2 id="&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;">&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;</h2>
<h3 id="getclients">getClients</h3>
<pre><code class="lang-java"><span class="hljs-comment">//&#x83B7;&#x5F97;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x5224;&#x65AD;&#x662F;&#x5426;&#x4E3A;&#x5171;&#x4EAB;&#x8FDE;&#x63A5;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;&#x5171;&#x4EAB;&#x540C;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x3002;&#x662F;&#x5426;&#x914D;&#x7F6E;&#x4E86;&#x591A;&#x4E2A;&#x8FDE;&#x63A5;&#x901A;&#x9053; connections&#xFF0C;&#x9ED8;&#x8BA4;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x3002;</span>
&gt;getClients(url) 
  <span class="hljs-comment">//&#x83B7;&#x5F97;&#x4E00;&#x4E2A;&#x5171;&#x4EAB;&#x8FDE;&#x63A5;&#x3002;&#x68C0;&#x67E5;&#x5F53;&#x524D;&#x7684;key&#x68C0;&#x67E5;&#x8FDE;&#x63A5;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x521B;&#x5EFA;&#x8FC7;&#x5E76;&#x4E14;&#x53EF;&#x7528;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x5219;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x5E76;&#x4E14;&#x589E;&#x52A0;&#x8FDE;&#x63A5;&#x7684;&#x4E2A;&#x6570;&#x3002;&#x5426;&#x5219;&#x521D;&#x59CB;&#x5316;&#x8FDE;&#x63A5;&#x5E76;&#x7F13;&#x5B58;&#x3002;key = url.getAddress();</span>
    &gt;getSharedClient()
      <span class="hljs-comment">//&#x6839;&#x636E;&#x8FDE;&#x63A5;&#x6570;&#x914D;&#x7F6E;&#xFF0C;&#x6765;&#x6784;&#x5EFA;&#x6307;&#x5B9A;&#x4E2A;&#x6570;&#x7684;&#x94FE;&#x63A5;&#x3002;&#x9ED8;&#x8BA4;&#x4E3A;1</span>
      &gt;buildReferenceCountExchangeClientList
          <span class="hljs-comment">//&#x521D;&#x59CB;&#x5316;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;&#x7684;&#x65B9;&#x6CD5;&#x4E86;&#xFF0C;&#x6839;&#x636E;url&#x4E2D;&#x914D;&#x7F6E;&#x7684;&#x53C2;&#x6570;&#x8FDB;&#x884C;&#x8FDC;&#x7A0B;&#x901A;&#x4FE1;&#x7684;&#x6784;&#x5EFA;</span>
          &gt;initClient()
              <span class="hljs-comment">//&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;</span>
              &gt;Exchangers.connect()
                  &gt;HeaderExchange.connect
                      <span class="hljs-comment">//&#x4F7F;&#x7528;netty&#x6784;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;</span>
                      &gt;NettyTransport.connect
                          &gt;<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> NettyClient(url, listener);
</code></pre>
<h2 id="directory">Directory</h2>
<p>Directory &#x7684;&#x7528;&#x9014;&#x662F;&#x4FDD;&#x5B58; Invoker&#xFF0C;&#x5176;&#x5B9E;&#x73B0;&#x7C7B; RegistryDirectory &#x662F;&#x4E00;&#x4E2A;&#x52A8;&#x6001;&#x670D;&#x52A1;&#x76EE;&#x5F55;&#xFF0C;&#x53EF;&#x611F;&#x77E5;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#x914D;&#x7F6E;&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x5B83;&#x6240;&#x6301;&#x6709;&#x7684; Inovker &#x5217;&#x8868;&#x4F1A;&#x968F;&#x7740;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#x5185;&#x5BB9;&#x7684;&#x53D8;&#x5316;&#x800C;&#x53D8;&#x5316;&#x3002;&#x6BCF;&#x6B21;&#x53D8;&#x5316;&#x540E;&#xFF0C;RegistryDirectory &#x4F1A;&#x52A8;&#x6001;&#x589E;&#x5220; Inovker&#x3002;</p>
<p>&#x5728;RegistryDirectory&#x4E2D;&#x6709;&#x4E00;&#x4E2A;&#x6210;&#x5458;&#x5C5E;&#x6027;&#xFF0C;&#x4FDD;&#x5B58;&#x4E86;&#x670D;&#x52A1;&#x5730;&#x65B9;&#x5730;&#x5740;&#x5BF9;&#x5E94;&#x7684;invoke&#x4FE1;&#x606F;&#x3002;</p>
<pre><code class="lang-java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> Map&lt;String, Invoker&lt;T&gt;&gt; urlInvokerMap;
</code></pre>
<p>&#x8FD9;&#x4E2A;invoker&#x662F;&#x52A8;&#x6001;&#x7684;&#xFF0C;&#x57FA;&#x4E8E;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#x7684;&#x53D8;&#x5316;&#x800C;&#x53D8;&#x5316;&#x7684;&#x3002;&#x5B83;&#x7684;&#x521D;&#x59CB;&#x5316;&#x8FC7;&#x7A0B;&#x7684;&#x94FE;&#x8DEF;&#x662F; RegistryDirectory.notify-&gt;refreshInvoker-&gt;toInvokers &#x897F;&#x9762;&#x7684;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x4E2D;&#x3002;&#x8FD4;&#x56DE;&#x7684;&#x662F;&#x4E00;&#x4E2A;DubboInvoker&#x5BF9;&#x8C61;&#x3002;</p>
<h2 id="&#x603B;&#x7ED3;">&#x603B;&#x7ED3;</h2>
<p>RegistryProtocol.refer &#x8FC7;&#x7A0B;&#x4E2D;&#x6709;&#x4E00;&#x4E2A;&#x5173;&#x952E;&#x6B65;&#x9AA4;&#xFF0C;&#x5373;&#x5728;&#x76D1;&#x542C;&#x5230;&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x8005;url&#x65F6;&#x89E6;&#x53D1; RegistryDirectory.notify() &#x65B9;&#x6CD5;&#x3002;</p>
<p>RegistryDirectory.notify() &#x65B9;&#x6CD5;&#x8C03;&#x7528; refreshInvoker() &#x65B9;&#x6CD5;&#x5C06;&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x8005;urls&#x8F6C;&#x6362;&#x4E3A;&#x5BF9;&#x5E94;&#x7684;&#x8FDC;&#x7A0B;invoker &#xFF0C;&#x6700;&#x7EC8;&#x8C03;&#x7528;&#x5230; DubboProtocol.refer() &#x65B9;&#x6CD5;&#x751F;&#x6210;&#x5BF9;&#x5E94;&#x7684; DubboInvoker &#x3002;</p>
<p>DubboInvoker &#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x4E2D;&#x6709;&#x4E00;&#x9879;&#x5165;&#x53C2; ExchangeClient[] clients &#xFF0C;&#x5373;&#x5BF9;&#x5E94;&#x7F51;&#x7EDC;&#x5BA2;&#x6237;&#x7AEF; Client &#x3002;DubboInvoker&#x5C31;&#x662F;&#x901A;&#x8FC7;&#x8C03;&#x7528; client.request() &#x65B9;&#x6CD5;&#x5B8C;&#x6210;&#x7F51;&#x7EDC;&#x901A;&#x4FE1;&#x7684;&#x8BF7;&#x6C42;&#x53D1;&#x9001;&#x548C;&#x54CD;&#x5E94;&#x63A5;&#x6536;&#x529F;&#x80FD;&#x3002;</p>
<p>Client &#x7684;&#x5177;&#x4F53;&#x751F;&#x6210;&#x8FC7;&#x7A0B;&#x5C31;&#x662F;&#x901A;&#x8FC7; DubboProtocol &#x7684; initClient(URL url) &#x65B9;&#x6CD5;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;HeaderExchangeClient&#x3002;</p>
<h1 id="&#x670D;&#x52A1;&#x8C03;&#x7528;">&#x670D;&#x52A1;&#x8C03;&#x7528;</h1>
<p>&#x6D88;&#x8D39;&#x8005;&#x521D;&#x59CB;&#x5316;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#xFF0C;&#x4F1A;&#x751F;&#x6210;&#x4E00;&#x4E2A;proxy&#xFF0C;&#x800C;&#x8FD9;&#x4E2A;proxy&#x672C;&#x8D28;&#x4E0A;&#x662F;&#x4E00;&#x4E2A;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x7C7B;&#x3002;</p>
<h2 id="avassistproxyfactorygetproxy">avassistProxyFactory.getProxy</h2>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">getProxy</span><span class="hljs-params">(Invoker&lt;T&gt; invoker, Class&lt;?&gt;[] interfaces)</span> </span>{
   <span class="hljs-keyword">return</span> (T) Proxy.getProxy(interfaces).newInstance(<span class="hljs-keyword">new</span> InvokerInvocationHandler(invoker)); 
}
</code></pre>
<p>&#x8FD9;&#x4E2A;invoker&#x5B9E;&#x9645;&#x4E0A;&#x662F;:MockClusterWrapper(FailoverCluster(directory)) &#x7136;&#x540E;&#x901A;&#x8FC7;InvokerInvocationHandler&#x505A;&#x4E86;&#x4E00;&#x5C42;&#x5305;&#x88C5;&#x53D8;&#x6210;&#x4E86; InvokerInvocationHandler(MockClusterWrapper(FailoverCluster(directory))</p>
<h2 id="proxygetproxy">proxy.getProxy</h2>
<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x91CC;&#x9762;&#xFF0C;&#x4F1A;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x5B83;&#x4EE3;&#x7406;&#x4E86;&#x5F53;&#x524D;&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5E76;&#x4E14;&#x65B9;&#x6CD5;&#x91CC;&#x9762;&#x662F;&#x4F7F;&#x7528;handler.invoke&#x8FDB;&#x884C;&#x8C03;&#x7528;&#x7684;&#x3002;</p>
<p>&#x800C;handler&#x53C8;&#x662F;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x5B9E;&#x73B0;: InvokerInvocationHandler(MockClusterWrapper(FailoverCluster(directory)))</p>
<h2 id="&#x8C03;&#x7528;&#x6D41;&#x7A0B;">&#x8C03;&#x7528;&#x6D41;&#x7A0B;</h2>
<pre><code class="lang-java"><span class="hljs-comment">//&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x5224;&#x65AD;&#x5F53;&#x524D;&#x8C03;&#x7528;&#x7684;&#x8FDC;&#x7A0B;&#x65B9;&#x6CD5;&#xFF0C;&#x5982;&#x679C;&#x662F;tostring&#x3001;hashcode&#x3001;equals&#xFF0C;&#x5C31;&#x76F4;&#x63A5;&#x8FD4;&#x56DE; </span>
<span class="hljs-comment">//&#x5426;&#x5219;&#xFF0C;&#x8C03;&#x7528;invoker.invoke,&#x8FDB;&#x5165;&#x5230; MockClusterWrapper.invoke &#x65B9;&#x6CD5;</span>
InvokerInvocationHandler.invoke
    <span class="hljs-comment">//&#x662F;&#x5426;&#x5BA2;&#x6237;&#x7AEF;&#x5F3A;&#x5236;&#x914D;&#x7F6E;&#x4E86;mock&#x8C03;&#x7528;&#xFF0C;&#x662F;&#x5426;&#x51FA;&#x73B0;&#x5F02;&#x5E38;,&#x4F7F;&#x7528;Mock&#x5B9E;&#x73B0;&#x670D;&#x52A1;&#x964D;&#x7EA7;&#x3002;&#x6B63;&#x5E38;&#x5219;&#x8FDB;&#x5165;&#x4E0B;&#x4E00;&#x4E2A;invoke&#x3002;</span>
  &gt;MockClusterInvoker.invoke
  <span class="hljs-comment">//&#x4E0B;&#x4E00;&#x4E2A;invoke&#xFF0C;&#x5E94;&#x8BE5;&#x8FDB;&#x5165;FailoverClusterInvoke&#x3002;&#x8C03;&#x7528;&#x7236;&#x7C7B;AbstractClusterInvoker.invoke&#x3002;</span>
  <span class="hljs-comment">//1.&#x7ED1;&#x5B9A;attachments&#xFF0C;Dubbo&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; RpcContext &#x4E0A;&#x7684; setAttachment &#x548C; getAttachment &#x5728; &#x670D;&#x52A1;&#x6D88;&#x8D39;&#x65B9;&#x548C;&#x63D0;&#x4F9B;&#x65B9;&#x4E4B;&#x95F4;&#x8FDB;&#x884C;&#x53C2;&#x6570;&#x7684;&#x9690;&#x5F0F;&#x4F20;&#x9012;</span>
  <span class="hljs-comment">//2.&#x4ECE;directory&#x91CC;&#x9762;&#x83B7;&#x5F97;invoker&#x5217;&#x8868;&#xFF0C;&#x901A;&#x8FC7;&#x670D;&#x52A1;&#x8DEF;&#x7531;&#x5BF9;invoker&#x7B5B;&#x9009;</span>
  <span class="hljs-comment">//3.initLoadBalance &#x521D;&#x59CB;&#x5316;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x673A;&#x5236;</span>
  <span class="hljs-comment">//4.&#x6267;&#x884C;doInvoke</span>
  &gt;AbstractClusterInvoker.invoke
      <span class="hljs-comment">//&#x83B7;&#x5F97;&#x91CD;&#x8BD5;&#x7684;&#x6B21;&#x6570;&#x8FDB;&#x884C;&#x5FAA;&#x73AF;&#x3002;&#x901A;&#x8FC7;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x83B7;&#x5F97;&#x76EE;&#x6807;DubboInvoker&#x3002;&#x5982;&#x679C;&#x6267;&#x884C;&#x6210;&#x529F;&#x5219;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;,&#x5982;&#x679C;&#x51FA;&#x73B0;&#x5F02;&#x5E38;&#x5219;&#x629B;&#x51FA;</span>
      &gt;FailoverClusterInvoker.doInvoke
          <span class="hljs-comment">//1.&#x5C06;&#x76EE;&#x6807;&#x65B9;&#x6CD5;&#x4EE5;&#x53CA;&#x7248;&#x672C;&#x597D;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x653E;&#x5165;&#x5230;Invocation&#x4E2D;</span>
          <span class="hljs-comment">//2.&#x83B7;&#x5F97;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;</span>
          &gt;DubboInvoker.doInvoker
                <span class="hljs-comment">//&#x521B;&#x5EFA;&#x8BF7;&#x6C42;&#x5BF9;&#x8C61;,netty&#x8BF7;&#x6C42;</span>
              &gt;currentClient.request
                  <span class="hljs-comment">//NettyClient</span>
                  &gt;channel.send(req);
</code></pre>
<h2 id="&#x603B;&#x7ED3;">&#x603B;&#x7ED3;</h2>
<p><img src="dubbo10.png" alt="dubbo10"></p>
<p>&#x8FD9;&#x91CC;&#x7684; Invoker &#x662F; Provider &#x7684;&#x4E00;&#x4E2A;&#x53EF;&#x8C03;&#x7528; Service &#x7684;&#x62BD;&#x8C61;&#xFF0C; Invoker &#x5C01;&#x88C5;&#x4E86; Provider &#x5730; &#x5740;&#x53CA; Service &#x63A5;&#x53E3;&#x4FE1;&#x606F;&#x3002;</p>
<p>Directory &#x4EE3;&#x8868;&#x591A;&#x4E2A; Invoker &#xFF0C;&#x53EF;&#x4EE5;&#x628A;&#x5B83;&#x770B;&#x6210; List\<invoker> &#x3002;&#x5B83;&#x7684;&#x503C;&#x53EF;&#x80FD;&#x662F;&#x52A8;&#x6001;&#x53D8;&#x5316;&#x7684;&#xFF0C;&#x6BD4;&#x5982;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#x63A8;&#x9001;&#x53D8;&#x66F4;</invoker></p>
<p>Cluster &#x5C06; Directory &#x4E2D;&#x7684;&#x591A;&#x4E2A; Invoker &#x4F2A;&#x88C5;&#x6210;&#x4E00;&#x4E2A; Invoker &#xFF0C;&#x5BF9;&#x4E0A;&#x5C42;&#x900F;&#x660E;&#xFF0C;&#x4F2A;&#x88C5;&#x8FC7;&#x7A0B;&#x5305;&#x542B;&#x4E86;&#x5BB9;&#x9519;&#x903B;&#x8F91;&#xFF0C;&#x8C03;&#x7528;&#x5931;&#x8D25;&#x540E;&#xFF0C;&#x91CD;&#x8BD5;&#x53E6;&#x4E00;&#x4E2A;&#x3002;</p>
<p>Router &#x8D1F;&#x8D23;&#x4ECE;&#x591A;&#x4E2A; Invoker &#x4E2D;&#x6309;&#x8DEF;&#x7531;&#x89C4;&#x5219;&#x9009;&#x51FA;&#x5B50;&#x96C6;&#xFF0C;&#x6BD4;&#x5982;&#x8BFB;&#x5199;&#x5206;&#x79BB;&#xFF0C;&#x5E94;&#x7528;&#x9694;&#x79BB;&#x7B49;</p>
<p>LoadBalance &#x8D1F;&#x8D23;&#x4ECE;&#x591A;&#x4E2A; Invoker &#x4E2D;&#x9009;&#x51FA;&#x5177;&#x4F53;&#x7684;&#x4E00;&#x4E2A;&#x7528;&#x4E8E;&#x672C;&#x6B21;&#x8C03;&#x7528;&#xFF0C;&#x9009;&#x7684;&#x8FC7;&#x7A0B;&#x5305;&#x542B;&#x4E86;&#x8D1F;&#x8F7D;&#x5747;&#x8861; &#x7B97;&#x6CD5;&#xFF0C;&#x8C03;&#x7528;&#x5931;&#x8D25;&#x540E;&#xFF0C;&#x9700;&#x8981;&#x91CD;&#x9009;&#x3002;</p>
<p>&#x6700;&#x540E;&#x8C03;&#x7528;DubboInvoker&#xFF0C;&#x901A;&#x8FC7;Netty&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x5BF9;&#x8C61;&#x3002;</p>
<h1 id="&#x670D;&#x52A1;&#x7AEF;&#x6D88;&#x606F;&#x63A5;&#x6536;&#x5904;&#x7406;">&#x670D;&#x52A1;&#x7AEF;&#x6D88;&#x606F;&#x63A5;&#x6536;&#x5904;&#x7406;</h1>
<p>&#x670D;&#x52A1;&#x7AEF;&#x901A;&#x8FC7;Netty&#x63A5;&#x6536;&#x6D88;&#x606F;</p>
<pre><code class="lang-java"><span class="hljs-meta">@Override</span> 
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> throwsException </span>{      
  NettyChannel channel = NettyChannel.getOrAddChannel(ctx.channel(), url,handler);        
  <span class="hljs-keyword">try</span> {           
    handler.received(channel, msg);       
  } <span class="hljs-keyword">finally</span> {            
    NettyChannel.removeChannelIfDisconnected(ctx.channel());
  } 
}

<span class="hljs-comment">//</span>
NettyHandler
  <span class="hljs-comment">//&#x590D;&#x5408;&#x6D88;&#x606F;&#x5904;&#x7406;,&#x62C6;&#x5206;&#x6210;&#x591A;&#x4E2A;Message</span>
  -&gt;MultiMessageHandler
      <span class="hljs-comment">//&#x5FC3;&#x8DF3;&#x6D88;&#x606F;&#x5904;&#x7406;&#xFF0C;&#x63A5;&#x6536;&#x5FC3;&#x8DF3;&#x5E76;&#x53D1;&#x9001;&#x5FC3;&#x8DF3;&#x54CD;&#x5E94;</span>
      -&gt;HeartbeatHandler
          <span class="hljs-comment">//&#x4E1A;&#x52A1;&#x7EBF;&#x7A0B;&#x8F6C;&#x5316;&#x5904;&#x7406;&#x5668;&#xFF0C;&#x628A;&#x63A5;&#x6536;&#x5230;&#x7684;&#x6D88;&#x606F;&#x5C01;&#x88C5;&#x6210;ChannelEventRunnable&#x53EF;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x7ED9;&#x7EBF;&#x7A0B;&#x6C60;&#x5904;&#x7406;&#x3002;</span>
          <span class="hljs-comment">//&#x7528;&#x6765;&#x63A5;&#x6536;&#x6D88;&#x606F;&#x4E8B;&#x4EF6;&#xFF0C;&#x5E76;&#x4E14;&#x6839;&#x636E;&#x4E8B;&#x4EF6;&#x7684;&#x79CD;&#x7C7B;&#x6765;&#x5206;&#x522B;&#x6267;&#x884C;&#x4E0D;&#x540C;&#x7684;&#x64CD;&#x4F5C;</span>
          -&gt;AllChannelHandler
              <span class="hljs-comment">//&#x4E1A;&#x52A1;&#x89E3;&#x7801;&#x5904;&#x7406;&#x5668;</span>
              -&gt;DecodeHandler
                  <span class="hljs-comment">//&#x5BF9;&#x6D88;&#x606F;&#x8FDB;&#x884C;&#x5206;&#x7C7B;&#xFF0C;&#x9488;&#x5BF9;&#x4E0D;&#x540C;&#x7684;&#x6D88;&#x606F;&#x7C7B;&#x578B;&#x505A;&#x4E86;&#x4E0D;&#x540C;&#x7684;&#x903B;&#x8F91;&#x8C03;&#x7528;</span>
                  -&gt;HeaderExchangeHandler
                          <span class="hljs-comment">//&#x6B63;&#x5E38;&#x53CC;&#x5411;&#x8BF7;&#x6C42;&#x6D88;&#x606F;&#x8C03;&#x7528;</span>
                          -&gt;handleRequest
                              -&gt;DubboProtocol$requestHandler(receive)
                                  -&gt;reply
</code></pre>
<h2 id="exchangehandlerreply">ExchangeHandler.reply</h2>
<p>&#x628A;message&#x8F6C;&#x5316;&#x4E3A;Invocation </p>
<p>&#x8C03;&#x7528;getInvoker&#x83B7;&#x5F97;&#x4E00;&#x4E2A;Invoker&#x5BF9;&#x8C61; </p>
<p>&#x901A;&#x8FC7;Resultresult=invoker.invoke(inv)&#xFF0C;&#x8FDB;&#x884C;&#x53CD;&#x5C04;&#x8C03;&#x7528;</p>
<pre><code class="lang-java"> <span class="hljs-function"><span class="hljs-keyword">public</span> CompletableFuture&lt;Object&gt; <span class="hljs-title">reply</span><span class="hljs-params">(ExchangeChannel channel, Object message)</span></span>{
   Invocation inv = (Invocation) message; 
   Invoker&lt;?&gt; invoker = getInvoker(channel, inv);    
   RpcContext rpcContext = RpcContext.getContext();           
   rpcContext.setRemoteAddress(channel.getRemoteAddress());           
   Result result = invoker.invoke(inv);
 }
</code></pre>
<h2 id="getinvoker">getInvoker</h2>
<p>&#x83B7;&#x5F97;&#x4E00;&#x4E2A;invoker&#x7684;&#x5B9E;&#x73B0;&#x3002;</p>
<pre><code class="lang-java">Invoker&lt;?&gt; getInvoker(Channel channel, Invocation inv){    
  String serviceKey = serviceKey(port, path,inv.getAttachments().get(Constants.VERSION_KEY),
                                   inv.getAttachments().get(Constants.GROUP_KEY));           
  DubboExporter&lt;?&gt; exporter = (DubboExporter&lt;?&gt;)exporterMap.get(serviceKey);
  <span class="hljs-keyword">return</span> exporter.getInvoker();  
}
</code></pre>
<p>exporterMap&#x662F;&#x5728;&#x670D;&#x52A1;&#x53D1;&#x5E03;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x4FDD;&#x5B58;&#x7684;Invoker&#x3002;key&#x5C31;&#x662F;&#x5BF9;&#x5E94;&#x7684;interface:port&#x3002;&#x5728;&#x670D;&#x52A1;&#x53D1;&#x5E03;&#x65F6;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x628A;invoker&#x5305;&#x88C5;&#x6210;&#x4E86;DubboExpoter&#x3002;&#x7136;&#x540E;&#x653E;&#x5165;&#x5230;exporterMap&#x4E2D;&#x3002;</p>

<script>console.log("plugin-popup....");document.onclick = function(e){ e.target.tagName === "IMG" && window.open(e.target.src,e.target.src)}</script><style>img{cursor:pointer}</style>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="服务发布和注册源码.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: 服务发布及注册">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"服务消费","level":"1.7.4","depth":2,"next":{"title":"Zookeeper","level":"1.8","depth":1,"ref":"","articles":[{"title":"节点","level":"1.8.1","depth":2,"path":"content/Zookeeper/节点.md","ref":"content/Zookeeper/节点.md","articles":[]},{"title":"集群","level":"1.8.2","depth":2,"path":"content/Zookeeper/集群.md","ref":"content/Zookeeper/集群.md","articles":[]},{"title":"启动及选举","level":"1.8.3","depth":2,"path":"content/Zookeeper/启动与选举源码.md","ref":"content/Zookeeper/启动与选举源码.md","articles":[]},{"title":"监听Watch","level":"1.8.4","depth":2,"path":"content/Zookeeper/Watcher.md","ref":"content/Zookeeper/Watcher.md","articles":[]},{"title":"应用场景","level":"1.8.5","depth":2,"path":"content/Zookeeper/应用场景.md","ref":"content/Zookeeper/应用场景.md","articles":[]}]},"previous":{"title":"服务发布及注册","level":"1.7.3","depth":2,"path":"content/Dubbo/服务发布和注册源码.md","ref":"content/Dubbo/服务发布和注册源码.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-search","-lunr","search-pro","code","splitter","expandable-chapters","page-toc-button","back-to-top-button","popup","-sharing"],"styles":{"website":"styles/website.css"},"pluginsConfig":{"splitter":{},"search-pro":{},"popup":{},"code":{"copyButtons":true},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"page-toc-button":{},"back-to-top-button":{},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"expandable-chapters":{}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"面试知识点汇总","gitbook":"*"},"file":{"path":"content/Dubbo/服务消费源码.md","mtime":"2020-11-19T14:46:06.319Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-12-14T10:11:07.647Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-page-toc-button/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

